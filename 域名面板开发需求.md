# 域名证书管理面板开发需求文档

## 项目概述
本项目旨在开发一个域名证书管理面板，用于监控和管理SSL证书的状态，支持手动和自动续期功能。

## 技术栈
- **开发语言**: Shell Script
- **运行环境**: Linux/macOS
- **依赖工具**: Docker, Certbot

## 核心功能

### 1. 域名证书状态面板
运行脚本后，以表格形式显示所有域名的证书状态信息：

| 序号 | 域名 | 到期时间 | 剩余天数 | 状态 | 自动续期 | 证书位置 |
|------|------|----------|----------|----------|------|----------|
| 1 | example.com | 2024-03-15 | 30 | 正常 | 是 | example.com/cert.pem |

**字段说明：**
- **序号**: 用于操作指令的域名标识符
- **域名**: 完整的域名地址
- **证书位置**: 证书文件存储的相对路径(不需要显示完整路径)，只需要显示`example.com/cert.pem`
- **到期时间**: 证书过期日期 (YYYY-MM-DD格式)
- **剩余天数**: 距离过期的天数
- **状态**: 
  - `正常` (剩余天数 > 7)
  - `即将过期` (剩余天数 3-7天)
  - `已过期` (剩余天数 ≤ 0)
  - `警告` (剩余天数 1-2天)
- **自动续期**: 是否启用自动续期功能

### 2. 交互式操作指令
面板支持以下操作指令：

- **`s`**然后输入[序号]: 为指定序号的域名执行手动续期
- **`a`**: 为所有启用自动续期且进入`即将过期`、`已过期`和`警告`状态的域名执行续期
- **`r`**: 刷新显示当前状态
- **`t`**然后输入[序号]: 切换指定域名的自动续期开关
- **`q`**: 退出程序
- **`h`**: 显示帮助信息

### 3. 自动续期机制
- 可通过./cert_manager.sh --auto-renew为所有启用自动续期且进入`即将过期`、`已过期`和`警告`状态的域名执行续期,等同于上面的`a`命令
- 用户可自行通过cron设置定时任务执行自动续期，需要提供使用案例
## 技术要求

### 1. 配置管理
- **证书路径**: 默认`./cert`，支持自定义路径
- **续期脚本路径**: 默认`./ca_update`，支持自定义路径


### 2. 证书解析
- 自动扫描证书目录，识别所有有效证书
- 解析证书文件获取到期时间信息
- 支持常见证书格式：.pem, .crt, .cert

### 3. 错误处理
- 证书文件不存在或损坏的处理
- 续期脚本执行失败的错误提示
- 网络连接异常的重试机制

### 4. 用户体验
- 清晰的表格显示，支持颜色标识不同状态
- 操作确认提示，避免误操作
- 进度显示，续期过程中显示执行状态

## 非功能性要求

### 1. 性能要求
- 启动时间 < 3秒
- 证书状态刷新 < 1秒
- 支持管理100+域名证书

### 2. 可靠性要求
- 续期操作失败时不影响其他域名
- 提供操作日志和错误日志


## 部署要求

### 1. 环境依赖
- Bash 4.0+
- Docker (用于certbot)
- OpenSSL (用于证书解析)



## 验收标准

1. ✅ 能够正确显示所有域名证书状态
2. ✅ 手动续期功能正常工作
3. ✅ 所有交互指令响应正确
4. ✅ 错误情况下有适当的提示信息
5. ✅ 日志记录完整且格式规范

## 后续扩展（先不考虑）

- Web界面支持
- 邮件/短信告警通知
- 多服务器证书同步
- 证书申请功能集成
- API接口支持
